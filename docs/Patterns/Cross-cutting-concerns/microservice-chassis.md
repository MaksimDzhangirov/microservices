# Шаблон: Микросервисное шасси

[Оригинал](https://microservices.io/patterns/microservice-chassis.html)

## Дано

Когда вы начинаете разработку приложения, вы часто тратите значительное 
количество времени на написание логики сборки и создание механизмов для 
решения сквозных задач. Логика сборки создает и тестирует приложение, а 
также упаковывает его в готовый для запуска на продакшене формат, например 
образ Docker контейнера. Например, большая часть логики сборки для
Java приложения реализована с использованием Gradle или Maven. Она также 
может состоять из сценариев конфигурации для инструмента автоматизации 
сборки, такого как CircleCI или Github Actions. На первый взгляд логика 
сборки кажется довольно простой. Однако даже определение тщательно 
отобранного набора зависимостей может оказаться чрезвычайно сложной задачей.

В дополнение к логике сборки вам необходимо решить сквозные задачи. 
Примеры сквозных проблем могут быть:

* Безопасность — например, REST API должны быть защищены с помощью 
[Токена доступа](../Security/access-token.md)
* [Внешняя конфигурация](../Cross-cutting-concerns/externalized-configuration.md) — включает 
  учетные данные и сетевые адреса внешних сервисов, таких как базы данных 
  и брокеры сообщений
* [Ведение логов](../Observability/log-aggregation.md) — настройка 
  среды ведения логов, такой как log4j или logback
* [Проверка работоспособности](../Observability/health-check-api.md) — URL-адрес, 
  по которому сервис мониторинга может «пинговать» приложение для определения
  его работоспособности
* [Метрики](../Observability/application-metrics.md) — показатели, которые
  дают представление о том, что делает приложение и как оно работает
* [Распределенная трассировка](../Observability/distributed-tracing.md) — отладочные 
  сервисы с кодом, присваивающим каждому внешнему запросу уникальный 
  идентификатор, который передается между сервисами

Наряду с этими общими сквозными проблемами существуют также сквозные 
проблемы, специфичные для технологий, которые использует приложение.
Приложениям, которые используют инфраструктурные сервисы, такие как базы
данных или брокеры сообщений, для этого требуется стандартная конфигурация.
Например, приложения, использующие реляционную базу данных, должны быть 
настроены, используя пул соединений. Веб-приложения, обрабатывающие 
HTTP-запросы, также нуждаются в стандартной конфигурации.

Обычно тратится один-два дня, а иногда и больше, на написание логики 
сборки и реализацию сквозных задач. Если вы собираетесь потратить месяцы 
или годы на разработку монолитного приложения, то первоначальные 
инвестиции будут незначительными. Однако ситуация сильно отличается, 
если вы разрабатываете приложение с [микросервисной архитектурой](../Application-architecture-patterns/pattern-microservice-architecture.md). Существует 
десятки или сотни сервисов. Вы будете часто создавать новые сервисы, 
разработка каждого из которых займет всего несколько дней или недель. Вы 
не можете позволить себе тратить несколько дней на настройку каждого 
сервиса. Ещё хуже то, что в микросервисной архитектуре существуют дополнительные 
сквозные проблемы, с которыми вам приходится иметь дело, включая 
регистрацию и обнаружение сервисов, а также Circuit Breakerы для надежной 
обработки частичных сбоев.

Одним из решений является создание [Готовый шаблон сервиса](service-template.md), представляющего 
собой шаблон исходного кода, который разработчик может скопировать, чтобы 
быстро приступить к разработке нового сервиса. Однако недостатком Готового 
шаблона сервиса является то, что это программирование вида 
«скопировать/вставить»: когда необходимо изменить логику сборки и 
логику сквозных задач, каждый сервис необходимо обновлять отдельно.

![](../../../images/microservice-chassis/Service_template_limitations.png)

## Хотите узнать больше об этом шаблоне?

Взгляните на мой [Manning LiveProject](https://microservices.io/post/patterns/2022/03/15/service-template-chassis-live-project.html), 
который научит вас разрабатывать готовый шаблон сервиса и микросервисное шасси.

![](../../../images/microservice-chassis/Microservice_chassis.png)

## Задача

Как команда может быстро создать и настроить легко поддерживаемую кодовую 
базу для готового для запуска на продакшене сервиса, чтобы они могли 
приступить к разработке его бизнес-логики?

## Дополнительные условия

* Сервис должен реализовать
  * логику сборки, которая создает и тестирует приложение, а также 
    упаковывает его в готовый для запуска на продакшене формат, например
    образ Docker контейнера
  * Сквозные проблемы, такие как внешняя конфигурация, ведение логов, 
    проверки работоспособности, метрики, регистрация и обнаружение сервисов,
    Circuit breakerы. Существуют также сквозные проблемы, характерные для 
    технологий, которые использует микросервисы.
* Создание нового микросервиса должно быть быстрым и простым
* Обновление существующих сервисов должно быть быстрым и простым, когда 
  меняются требования к логике сборки и сквозным проблемам

## Решение

Создайте фреймворк микросервисного шасси, который может стать основой 
для разработки ваших микросервисов. Шасси реализует

* Повторно используемую логику сборки, которая создает и тестирует сервис.
  Сюда входят, например, Gradle плагины.
* Механизмы, которые решают сквозные проблемы. Шасси обычно собирает и 
  настраивает набор фреймворков и библиотек, реализующих этот функционал.

[Готовый шаблон сервиса](service-template.md) — это пример сервиса, в 
котором используется микросервисное шасси.

![](../../../images/microservice-chassis/Microservice_chassis_big.png)

## Пример

Примеры фреймворков, которые являются отправной точкой для создания 
микросервисного шасси:

* Java
  * [Spring Boot](http://projects.spring.io/spring-boot/) и [Spring Cloud](http://cloud.spring.io/)
  * [Dropwizard](https://dropwizard.github.io/)
* Go
  * [Gizmo](http://open.blogs.nytimes.com/2015/12/17/introducing-gizmo/?_r=2)
  * [Micro](https://github.com/micro)
  * [Go kit](https://github.com/go-kit/kit)

## Преимущества и недостатки

Основное преимущество микросервисного шасси заключается в том, что используя 
его быстрее и проще поддерживать зависимости, логику сборки и логику для
сквозных понятий в актуальном состоянии. Вы просто делаете релиз новой 
версии фреймворка микросервисного шасси, содержащую необходимые изменения, и 
обновляете каждый сервис, чтобы он использовал её.

Одна из проблем заключается в том, что вам нужно микросервисное шасси для 
каждого языка программирования/фреймворка, который вы хотите использовать. 
Это может стать препятствием для применения нового языка программирования 
или фреймворка.

## Связанные шаблоны

С этим шаблоном связаны следующие:

* [Готовый шаблон сервиса](service-template.md) — шаблон сервиса, который 
  разработчики могут скопировать для создания нового приложения. Его можно 
  использовать как альтернативу шаблону микросервисное шасси или он 
  использует микросервисное шасси и просто содержит код и настройки, которые
  не относятся к шасси
* [Микросервисы](../Application-architecture-patterns/pattern-microservice-architecture.md) — этот 
  шаблон мотивирует использовать микросервисное шасси
* [Самостоятельная регистрация](../Service-discovery/self-registration.md) — микросервисное 
  шасси часто отвечает за регистрацию сервиса в реестре сервисов
* [Обнаружение на стороне клиента](../Service-discovery/client-side-discovery.md) — микросервисное 
  шасси часто отвечает за обнаружение сервисов на стороне клиента
* [Circuit Breaker](../Reliability/circuit-breaker.md) — фреймворк 
  микросервисного шасси может реализовывать этот шаблон
* [Распределенная трассировка](../Observability/distributed-tracing.md) — фреймворк 
  микросервисного шасси позволяет отлаживать код
* [Готовый шаблон сервиса](service-template.md) часто использует микросервисное шасси

## Смотри также

* Эту отличную [статью в блоге о готовом шаблоне сервиса](https://blog.thepete.net/blog/2020/09/25/service-templates-service-chassis/) от [@ph1](https://twitter.com/ph1)

## Где можно получить более подробную информацию

Взгляните на мой [Manning LiveProject](https://microservices.io/post/patterns/2022/03/15/service-template-chassis-live-project.html),
который научит вас разрабатывать готовый шаблон сервиса и микросервисное шасси.