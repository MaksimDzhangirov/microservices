# Шаблон: По сервису на виртуальной машине

[Оригинал](https://microservices.io/patterns/deployment/service-per-vm.html)

## Дано

Вы воспользовались шаблоном [Микросервисная архитектура](../Application-architecture-patterns/pattern-microservice-architecture.md) и
спроектировали свою систему как набор сервисов. Каждый сервис развертывается
как набор экземпляров сервиса для обеспечения пропускной способности и
доступности.

## Задача

Как оформить и развернуть сервисы?

## Дополнительные условия

* Сервисы написаны с использованием различных языков, фреймворков и
  версий фреймворков
* Каждый сервис состоит из нескольких экземпляров сервиса для обеспечения
  пропускной способности и доступности
* Сервис должен быть независимо развертываемым и масштабируемым
* Экземпляры сервиса должны быть изолированы друг от друга
* Вам нужно уметь быстро создавать и развертывать сервис
* Вы должны иметь возможность ограничивать ресурсы (ЦП и память),
  потребляемые сервисом.
* Вам необходимо отслеживать поведение каждого экземпляра сервиса
* Вы хотите, чтобы развертывание было надежным
* Вы должны развернуть приложение как можно более экономично

## Решение

Оформите сервис в виде образа виртуальной машины и разверните каждый 
экземпляр сервиса как отдельную виртуальную машину

## Примеры

Netflix оформляет каждый сервис как AMI EC2 образ и развертывает каждый 
экземпляр сервиса как EC2 инстанс

## Преимущества и недостатки

К преимуществам такого подхода относятся:

* Сервис легко масштабировать, увеличив количество экземпляров. Группы 
  Amazon Autoscaling могут делать это даже автоматически в зависимости от 
  нагрузки
* Виртуальная машина инкапсулирует детали технологии, используемой для 
  создания сервиса. Все сервисы, например, запускаются и останавливаются 
  точно так же
* Каждый экземпляр сервиса изолирован
* Виртуальная машина накладывает ограничения на ЦП и память, потребляемые 
  экземпляром сервиса
* IaaS решения, такие как AWS, предоставляют развитую и многофункциональную 
  инфраструктуру для развертывания и управления виртуальными машинами. 
  Например,
  * Гибкий балансировщик нагрузки -
  * Автоматически масштабируемые группы 
  * ...

К недостаткам этого подхода относятся:

* Создание образа виртуальной машины небыстрый процесс и занимает много времени

## Связанные шаблоны

* Этот шаблон является усовершенствованием [шаблона «По сервису на хосте»](single-service-per-host.md)
* [Шаблон «По сервису на контейнер»](service-per-container.md) является 
  альтернативным решением.
* [Шаблон «Бессерверное развертывание»](serverless-deployment.md) является 
  альтернативным решением.